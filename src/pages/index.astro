---
import Mainlayout from "../layouts/Mainlayout.astro";
import "../style/generalstyle.css";
import Button from "../components/Button.astro";
import Collaborate from "../components/Collaborate.astro";
import Carousel from "../components/Carousel.astro";

import ArtistListe from "../components/ArtistListe.astro";
const data = await fetch(
  "https://qqlcqmrveupfwluwoctv.supabase.co/rest/v1/affiliatedCphData",
  {
    method: "GET",
    headers: {
      apikey:
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFxbGNxbXJ2ZXVwZndsdXdvY3R2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDc3MzQ3MzQsImV4cCI6MjAyMzMxMDczNH0.18SZnOZc5uAHdiIeonTl5cOenfcDIkL4VOhqSCsTFwM",
    },
  }
).then((res) => res.json());

console.log(data);

// Filter function to get artists based on category
---

<Mainlayout id="frontpage">
  <section class="header_karrusel" id="highlights_link_sektion"></section>
  <section>
    <Carousel />
  </section>
  <div>
    <h3 class="intro">
      AFFILIATED IS A FIERCE BOUTIQUE INDEPENDENT RECORD LABEL, AIMING TO
      CULTUVATE A DIVERSE ROSTER OF UNDISCOVERED AND UPCOMING MUSIC TALENT.
    </h3>
  </div>
  <section class="artist_section" id="artist_link_sektion">
    <div class="artist_filter_buttons">
      <Button variant="filter_knap">ALL</Button>
      <Button variant="filter_knap">LABEL</Button>
      <Button variant="filter_knap">PUBLISHING</Button>
      <Button variant="filter_knap">MANAGEMENT</Button>
    </div>
    <hr class="underline" />
    <div class="cards_grid"></div>
  </section>
  <section class="artist grid_auto">
    {
      data.map((artist) => {
        return <ArtistListe data={artist} />;
      })
    }
  </section>
  <section class="collaborate" id="col_link_sektion">
    <div class="collab_grid">
      <img
        class="affiliated_logo"
        id="order"
        src="/public/images/affiliated_logo.png"
        alt="Affiliated Logo"
      />
      <div class="collab_text">
        <h2 class="collab_header">OUR COLLABORATORS</h2>
        <p class="collab_p">
          With the spread of our music, we want to create a platform for
          upcoming artists who do not want to compromise on their sound and
          vision. We dream of making the music industry more opne and
          transparent to create better opportunities for the smaller players. We
          wish to give listeners a greater insight into the dominationg forces
          of the music buisness, as well as why this must change to create equal
          opportunities for everyone in the industry.
        </p>
        <!-- <p class="collab_p">We deliver the same high standards as major record labels but at a more accessible price. Our visionary partnership emphasizes cooperation and the nurturing of upcoming talent. By working together, we enable partners to integrate top-tier music into their projects without exceeding their budget. Our commitment to supporting emerging artists ensures a dynamic and fresh musical landscape, fostering creativity and innovation. Join us in shaping a new era of collaborative musical excellence, where businesses and artists thrive together in a mutually beneficial partnership.
          </p> -->
      </div>
    </div>
    <div><Collaborate /></div>
  </section>
  <section class="contact" id="contact_link_sektion">
    <Button variant="primary" id="bookingBtn">BOOKING</Button>
    <Button variant="primary" id="contactBtn">CONTACT</Button>
    <div id="bookingMail" class="mail hidden">booking@affiliatedcph.com</div>
    <div id="contactMail" class="mail hidden">manager@affiliatedcph.com</div>
  </section>
  <img class="frontpage_logo" src="" alt="" />
</Mainlayout>

<style>
  .intro {
    margin: 2rem 4rem 2rem 4rem;
    font-size: 12px;
  }
  .collab_text {
    margin: auto;
    max-width: 24rem;
    text-align: left;
    padding-bottom: 3rem;
  }

  .collab_header {
    padding-bottom: 1.5rem;
  }

  .affiliated_logo {
    width: 20rem;
    height: auto;
    margin: auto;
  }
  .underline {
    width: 22rem;
    margin: auto;
  }
  .artist_filter_buttons {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
  }
  .grid_auto {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(310px, 2fr));
  }
  .mail {
    color: var(--textColor);
    text-decoration: underline;
    margin-top: 1rem;
    font-size: 1.2rem;
  }
  .hidden {
    display: none;
  }
  .contact {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    gap: 5rem;
    margin: 7rem;
  }
  .header_karrusel {
    margin-top: 6rem;
  }
  @media (min-width: 700px) {
    .intro {
      margin: 5rem 45rem 7rem 5rem;
      font-size: 24px;
    }
    .collab_grid {
      display: flex;
      flex-direction: row;
      justify-content: space-evenly;
    }

    .collab_grid > .collab_text {
      order: -1;
    }

    .collab_text {
      max-width: 45rem;
      padding-left: 5rem;
    }

    .affiliated_logo {
      width: 40rem;
      height: auto;
      margin: auto;
    }

    .collab_p {
      max-width: 100%;
    }
    .underline {
      width: 33rem;
      margin: auto;
    }
    .contact {
      gap: 10rem;
    }
  }
</style>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    function showMail(type) {
      const mailElement = document.getElementById(type);
      mailElement.classList.toggle("hidden");
    }

    document
      .getElementById("bookingBtn")
      .addEventListener("click", () => showMail("bookingMail"));
    document
      .getElementById("contactBtn")
      .addEventListener("click", () => showMail("contactMail"));
  });

  // Function to fetch data based on "stilling"
  async function fetchData(stilling) {
    const url = `https://qqlcqmrveupfwluwoctv.supabase.co/rest/v1/affiliatedCphData?stilling=${stilling}`;
    const response = await fetch(url, {
      method: "GET",
      headers: {
        apikey:
          "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFxbGNxbXJ2ZXVwZndsdXdvY3R2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDc3MzQ3MzQsImV4cCI6MjAyMzMxMDczNH0.18SZnOZc5uAHdiIeonTl5cOenfcDIkL4VOhqSCsTFwM",
      },
    });
    return response.json();
  }

  // Function to render artists
  function renderArtists(artists) {
    const artistSection = document.querySelector(".artist.grid_auto");
    artistSection.innerHTML = ""; // Clear previous content
    artists.forEach((artist) => {
      artistSection.innerHTML += `<ArtistListe data=${artist} />`;
    });
  }

  // Event listener for filter buttons
  document.querySelectorAll(".filter_knap").forEach((button) => {
    button.addEventListener("click", async () => {
      const stilling = button.textContent.toUpperCase();
      const data = await fetchData(stilling);
      renderArtists(data);
    });
  });
</script>
